<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Inter', 'Montserrat', 'Roboto', Arial, sans-serif;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            background: repeating-linear-gradient(135deg, #1e293b 0 40px, #0f172a 40px 80px, #1e293b 80px 120px, #0f172a 120px 160px);
            overflow-x: hidden;
            overflow-y: auto;
            position: relative;
        }
        /* QR pattern overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            pointer-events: none;
            opacity: 0.13;
            z-index: 0;
            background-size: 60px 60px;
            mix-blend-mode: lighten;
        }
        /* Hacker Matrix code rain overlay */
        body::after {
            content: '';
            pointer-events: none;
            position: fixed;
            left: 0; top: 0; width: 100vw; height: 100vh;
            z-index: 2;
            opacity: 0.18;
            background: url('data:image/svg+xml;utf8,<svg width="100%25" height="100%25" viewBox="0 0 400 400" fill="none" xmlns="http://www.w3.org/2000/svg"><g opacity="0.7">%3Ctext x="0" y="20" font-size="20" font-family="monospace" fill="%2300ff88" opacity="0.7"%3E1010101010101010%3C/text%3E%3Ctext x="0" y="60" font-size="20" font-family="monospace" fill="%2300ff88" opacity="0.5"%3E0110110011001100%3C/text%3E%3Ctext x="0" y="100" font-size="20" font-family="monospace" fill="%2300ff88" opacity="0.7"%3E1100110011001100%3C/text%3E%3Ctext x="0" y="140" font-size="20" font-family="monospace" fill="%2300ff88" opacity="0.5"%3E1010101010101010%3C/text%3E%3Ctext x="0" y="180" font-size="20" font-family="monospace" fill="%2300ff88" opacity="0.7"%3E0110110011001100%3C/text%3E%3Ctext x="0" y="220" font-size="20" font-family="monospace" fill="%2300ff88" opacity="0.5"%3E1100110011001100%3C/text%3E%3Ctext x="0" y="260" font-size="20" font-family="monospace" fill="%2300ff88" opacity="0.7"%3E1010101010101010%3C/text%3E%3Ctext x="0" y="300" font-size="20" font-family="monospace" fill="%2300ff88" opacity="0.5"%3E0110110011001100%3C/text%3E%3Ctext x="0" y="340" font-size="20" font-family="monospace" fill="%2300ff88" opacity="0.7"%3E1100110011001100%3C/text%3E%3Ctext x="0" y="380" font-size="20" font-family="monospace" fill="%2300ff88" opacity="0.5"%3E1010101010101010%3C/text%3E</g></svg>');
            background-size: 400px 400px;
            animation: codeRainMove 8s linear infinite;
        }
        @keyframes codeRainMove {
            0% { background-position-y: 0; }
            100% { background-position-y: 400px; }
        }
        .container {
            text-align: center;
            padding: 38px 0 38px 0;
            border-radius: 18px;
            background: rgba(10, 18, 10, 0.92);
            box-shadow: 0 8px 32px 0 #00ff8833, 0 0 0 2px #00ff88cc, 0 1.5px 32px 0 #000a;
            color: #eafbe6;
            width: 100vw;
            max-width: 100vw;
            margin: 0 auto;
            border: none;
            position: relative;
            backdrop-filter: blur(10px) saturate(1.2);
            z-index: 1;
            animation: borderPulse 3.5s cubic-bezier(.4,2,.6,1) infinite alternate;
            border: 2.5px solid #00ff88;
            box-shadow: 0 0 24px #00ff88cc, 0 0 8px #003311cc;
        }
        @keyframes borderPulse {
            0% { box-shadow: 0 8px 32px 0 #00ff8833, 0 0 0 2px #00ff88cc, 0 1.5px 32px 0 #000a; }
            100% { box-shadow: 0 8px 32px 0 #00ff88aa, 0 0 0 4px #00ff88cc, 0 1.5px 32px 0 #003311; }
        }
        h1 {
            color: #00ff88;
            font-size: 2.3rem;
            letter-spacing: 1.5px;
            font-weight: 800;
            text-shadow: 0 2px 12px #003311cc, 0 1px 0 #00ff8844;
            border-radius: 10px;
            font-family: 'Fira Mono', 'Consolas', 'Menlo', monospace;
            letter-spacing: 2.5px;
            text-shadow: 0 0 8px #00ff88, 0 0 2px #fff, 0 2px 12px #003311cc;
            animation: flicker 2.5s infinite alternate;
        }
        @keyframes flicker {
            0%, 100% { opacity: 1; text-shadow: 0 0 8px #00ff88, 0 0 2px #fff, 0 2px 12px #003311cc; }
            45% { opacity: 0.85; text-shadow: 0 0 12px #00ff88, 0 0 4px #fff, 0 2px 16px #003311cc; }
            50% { opacity: 0.7; text-shadow: 0 0 20px #00ff88, 0 0 8px #fff, 0 2px 24px #003311cc; }
            55% { opacity: 0.85; text-shadow: 0 0 12px #00ff88, 0 0 4px #fff, 0 2px 16px #003311cc; }
        }
        input[type="text"] {
            padding: 15px;
            font-size: 18px;
            width: 94%;
            margin: 20px 0;
            border-radius: 10px;
            border: 2px solid #00ff88;
            background: rgba(0, 0, 0, 0.85);
            color: #eafbe6;
            text-align: center;
            transition: border 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px #00ff8833;
        }
        input[type="text"]:focus {
            border: 2px solid #00ff88;
            outline: none;
            box-shadow: 0 4px 16px #00ff8833;
        }
        button, .main-menu-btn {
            padding: 15px 0;
            font-size: 1.12rem;
            font-weight: 700;
            border-radius: 10px;
            background: linear-gradient(90deg, #00ff88 0%, #003311 100%);
            color: #0a1a0a;
            border: none;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s, color 0.2s;
            box-shadow: 0 2px 8px #00ff8833;
            min-width: 170px;
            max-width: 240px;
            margin: 0 6px;
            letter-spacing: 0.5px;
            border: 2.5px solid #00ff88;
            box-shadow: 0 0 0 2px #00331144, 0 2px 8px #00ff8833;
            font-family: 'Inter', 'Montserrat', 'Roboto', Arial, sans-serif;
            letter-spacing: 1.2px;
        }
        button:hover, .main-menu-btn:hover {
            background: linear-gradient(90deg, #003311 0%, #00ff88 100%);
            color: #fff;
            box-shadow: 0 4px 16px #00ff8855;
        }
        button:active, .main-menu-btn:active, .qr-download-btn:active {
            box-shadow: 0 0 0 4px #00ff88aa, 0 2px 8px #00331133;
        }
        .main-menu-btn {
            flex: 1 1 0;
            margin: 0 10px;
            border-radius: 10px;
        }
        details {
            background: rgba(0, 32, 0, 0.55);
            border-radius: 10px;
            margin-bottom: 14px;
            box-shadow: 0 2px 8px #00ff8811, 0 1.5px 12px #000a;
            padding: 0 0 0 0;
            border: none;
            border-left: 4px solid #00ff88;
            border-right: 4px solid #003311;
            transition: background 0.2s, border-color 0.2s;
        }
        summary {
            color: #00ff88;
            font-size: 1.12rem;
            font-weight: 700;
            padding: 13px 0 13px 18px;
            outline: none;
            letter-spacing: 0.5px;
            background: rgba(0,0,0,0.04);
            border-bottom: 1px solid #003311;
            margin: 0;
            border-radius: 10px 10px 0 0;
        }
        details[open] {
            background: rgba(0, 32, 0, 0.85);
            border-left: 4px solid #003311;
            border-right: 4px solid #00ff88;
        }
        details > div {
            color: #eafbe6;
            padding: 18px 18px 13px 18px;
            background: rgba(0,0,0,0.06);
            border-left: 2px solid #00ff88;
            border-right: 2px solid #003311;
            border-bottom: 1px solid #00ff88;
            border-radius: 0 0 10px 10px;
        }
        #multi-results {
            display: flex;
            flex-wrap: wrap;
            gap: 32px 20px;
            margin-top: 20px;
            justify-content: center;
            align-items: flex-start;
            position: relative;
        }
        .qr-card {
            position: relative;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.92) 60%, rgba(0, 32, 0, 0.85) 100%);
            border-radius: 18px;
            box-shadow: 0 6px 32px 0 #00ff8833, 0 0 0 4px #00331122;
            padding: 24px 18px 20px 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.28s cubic-bezier(.4,2,.6,1), box-shadow 0.18s;
            will-change: transform;
            overflow: visible;
            min-height: 320px;
            border: 2px solid #00ff88;
            box-shadow: 0 0 8px #00ff88cc, 0 0 2px #003311cc;
        }
        .qr-card:hover {
            transform: scale(1.055) rotate(-2deg);
            box-shadow: 0 12px 40px 0 #00ff8877, 0 0 0 8px #00331144;
            z-index: 2;
            border-color: #003311;
            box-shadow: 0 0 0 6px #00ff88cc, 0 12px 40px 0 #00331177;
            border-color: #00ff88;
        }
        .qr-label-badge {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(90deg, #00ff88 0%, #003311 100%);
            color: #0a1a0a;
            font-weight: 800;
            font-size: 1.13rem;
            letter-spacing: 1px;
            border-radius: 12px;
            padding: 7px 24px;
            box-shadow: 0 2px 12px 0 #00ff8833;
            border: 2px solid #fff;
            text-shadow: 0 1px 2px #fff8;
            transition: background 0.2s, color 0.2s;
            text-shadow: 0 0 4px #00ff88, 0 0 2px #fff;
            background: #000d;
            border: 2px solid #00ff88;
        }
        .qr-card:hover .qr-label-badge {
            background: #003311;
            color: #00ff88;
            border-color: #00ff88;
        }
        .qr-img-glow {
            box-shadow: 0 0 0 7px #00ff8833, 0 0 32px 0 #00331155, 0 0 16px #00ff88cc;
        }
        .qr-img-glow::after {
            content: '';
            display: block;
            position: absolute;
            left: 0; right: 0;
            top: 0;
            height: 100%;
            pointer-events: none;
            background: linear-gradient(180deg, rgba(0,255,136,0.22) 0%, rgba(0,255,136,0.32) 50%, rgba(0,255,136,0.22) 100%);
        }
        .qr-text {
            color: #eafbe6;
            font-size: 1.04rem;
            margin-bottom: 12px;
            word-break: break-all;
            text-align: center;
            opacity: 0.97;
            font-family: 'Fira Mono', 'Consolas', 'Menlo', monospace;
            letter-spacing: 1.5px;
        }
        .qr-download-btn {
            background: linear-gradient(90deg, #00ff88 0%, #003311 100%);
            color: #0a1a0a;
            border-radius: 10px;
            padding: 11px 24px;
            font-weight:700;
            font-size: 1.01rem;
            margin-top: 12px;
            border: none;
            box-shadow: 0 2px 8px 0 #00ff8833;
            transition: background 0.2s, color 0.2s;
            border: 2.5px solid #00ff88;
            box-shadow: 0 0 0 2px #00331144, 0 2px 8px #00ff8833;
            font-family: 'Inter', 'Montserrat', 'Roboto', Arial, sans-serif;
            letter-spacing: 1.2px;
        }
        .qr-download-btn:hover {
            background: linear-gradient(90deg, #003311 0%, #00ff88 100%);
            color: #fff;
            border: 2px solid #00ff88;
        }
        /* Responsive improvements for all devices */
        @media (max-width: 1200px) {
            .container { width: 98vw; max-width: 98vw; padding: 18px 1vw; }
            #multi-results { gap: 18px 8px; }
        }
        @media (max-width: 900px) {
            .container { width: 99vw; max-width: 99vw; padding: 12px 0.5vw; border-radius: 10px; }
            #multi-results { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; }
            .qr-card { min-height: 220px; transform: none !important; border-radius: 10px; }
            h1 { font-size: 1.5rem; }
        }
        @media (max-width: 600px), (max-device-width: 600px) {
            .container { width: 100vw; max-width: 100vw; border-radius: 0; box-shadow: none; padding: 8px 0; }
            h1 { font-size: 1.1rem; padding: 8px 0; }
            #multi-results { grid-template-columns: 1fr; gap: 6px; }
            .qr-card { min-height: 120px; padding: 8px 2px 8px 2px; border-radius: 6px; }
            .qr-label-badge { font-size: 0.9rem; padding: 3px 8px; border-radius: 6px; }
            button, .main-menu-btn, .qr-download-btn { min-width: 90px; max-width: 100vw; font-size: 0.95rem; border-radius: 6px; padding: 10px 0; }
            input[type="text"] { font-size: 1rem; border-radius: 6px; padding: 10px; }
            details, summary, details > div { border-radius: 6px; }
        }
        @media (min-width: 1600px) {
            .container { max-width: 1200px; margin: 0 auto; }
            #multi-results { justify-content: center; }
        }
        @media (min-width: 2000px) {
            .container { max-width: 1600px; }
        }
        /* TV and landscape tablet: larger touch targets, more spacing */
        @media (min-width: 900px) and (max-width: 1600px) and (orientation: landscape) {
            .container { max-width: 90vw; }
            button, .main-menu-btn, .qr-download-btn { font-size: 1.2rem; min-width: 200px; padding: 18px 0; }
            .qr-card { min-height: 260px; }
        }
        @media (max-width: 600px) {
            .container { width: 100vw; border-radius: 10px; box-shadow: none; padding: 10px 0; }
            h1 { font-size: 1.3rem; }
            #multi-results { grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; }
            .qr-card { min-height: 180px; padding: 10px 4px 10px 4px; transform: none !important; }
            .qr-label-badge { font-size: 0.97rem; padding: 4px 10px; }
        }
        input, button, select { font-size: 1rem; font-family: 'Inter', 'Montserrat', 'Roboto', Arial, sans-serif; border-radius: 10px; }
        html, body { overflow-x: hidden; }
        .main-menu-btn-primary {
            font-size: 1.08rem;
            min-width: 120px;
            padding: 10px 0;
            background: linear-gradient(90deg, #00ff88 0%, #003311 100%);
            color: #0a1a0a;
            border: 2px solid #00ff88;
            box-shadow: 0 0 0 2px #00ff88aa, 0 2px 8px #00ff8833;
        }
        .main-menu-btn-secondary {
            font-size: 0.98rem;
            min-width: 90px;
            padding: 7px 0;
            background: linear-gradient(90deg, #003311 0%, #00ff88 100%);
            color: #fff;
            border: 1.5px solid #00ff88;
        }
        .main-menu-btn-accent {
            font-size: 1.01rem;
            min-width: 90px;
            padding: 8px 0;
            background: linear-gradient(90deg, #00ff88 0%, #003311 100%);
            color: #00ff88;
            border: 1.5px solid #00ff88;
            box-shadow: 0 0 0 1px #00ff88aa, 0 2px 8px #00ff8833;
        }
        .scan-btn {
            font-size: 0.98rem;
            min-width: 90px;
            padding: 7px 0;
            background: linear-gradient(90deg, #00ff88 0%, #003311 100%);
            color: #0a1a0a;
            border: 1.5px solid #00ff88;
        }
        .verify-btn-primary {
            font-size: 1.05rem;
            min-width: 110px;
            padding: 8px 0;
            background: linear-gradient(90deg, #00ff88 0%, #003311 100%);
            color: #0a1a0a;
            border: 1.5px solid #00ff88;
            margin-right: 8px;
        }
        .verify-btn-secondary {
            font-size: 0.95rem;
            min-width: 80px;
            padding: 6px 0;
            background: linear-gradient(90deg, #003311 0%, #00ff88 100%);
            color: #fff;
            border: 1.5px solid #00ff88;
        }
        .main-action-btn {
            font-size: 1.08rem;
            min-width: 120px;
            padding: 10px 0;
            background: linear-gradient(90deg, #00ff88 0%, #003311 100%);
            color: #fff;
            border: 2px solid #00ff88;
            box-shadow: 0 0 0 2px #00ff88aa, 0 2px 8px #00ff8833;
        }
        @media (max-width: 900px) {
            .main-menu-btn-primary, .main-menu-btn-secondary, .main-menu-btn-accent, .scan-btn, .verify-btn-primary, .verify-btn-secondary, .main-action-btn {
                font-size: 0.95rem;
                min-width: 70px;
                padding: 7px 0;
            }
        }
        @media (max-width: 600px) {
            .main-menu-btn-primary, .main-menu-btn-secondary, .main-menu-btn-accent, .scan-btn, .verify-btn-primary, .verify-btn-secondary, .main-action-btn {
                font-size: 0.9rem;
                min-width: 60px;
                padding: 6px 0;
            }
        }
        .main-menu-btn, .scan-btn, .verify-btn-primary, .verify-btn-secondary, .main-action-btn {
            margin: 0 8px 12px 8px;
            padding-left: 18px;
            padding-right: 18px;
            box-sizing: border-box;
        }
        .main-menu-btn-primary, .main-menu-btn-secondary, .main-menu-btn-accent, .scan-btn, .verify-btn-primary, .verify-btn-secondary, .main-action-btn {
            margin-bottom: 14px;
        }
    </style>
</head>
<body>
    <div class="shapes">
        <div style="top: 10%; left: 20%;"></div>
        <div style="top: 50%; left: 70%;"></div>
        <div style="top: 80%; left: 40%;"></div>
    </div>
    <div class="container">
        <h1>QR Code Generator</h1>
        <div id="main-menu" style="display: flex; flex-direction: row; justify-content: center; gap: 18px; margin-bottom: 28px;">
            <button id="single-btn" type="button" class="main-menu-btn main-menu-btn-primary">Single QR</button>
            <button id="multi-btn" type="button" class="main-menu-btn main-menu-btn-secondary">Multi QR</button>
            <button id="verify-btn" type="button" class="main-menu-btn main-menu-btn-accent">Verify QR</button>
        </div>
        <form id="single-form" method="POST" enctype="multipart/form-data" style="display:none;">
            <input type="text" name="text" id="single-text" placeholder="Enter text for QR code" required>
            <span id="trust-status" style="margin-left:10px; vertical-align:middle; display:none;"></span>
            <br>
            <!-- Collapsible: Custom QR Styling -->
            <details style="margin:10px 0; text-align:left;">
                <summary style="font-weight:600; color:#ff6600; cursor:pointer;">🎨 Custom QR Styling</summary>
                <div style="margin:10px 0 0 0;">
                    <label>QR Color: <input type="color" name="qr_color" id="qr_color" value="#000000"></label>
                    <label style="margin-left:15px;">Background: <input type="color" name="bg_color" id="bg_color" value="#ffffff"></label>
                    <br><br>
                    <label>Style:
                        <select name="qr_style" id="qr_style">
                            <option value="square">Square</option>
                            <option value="rounded">Rounded</option>
                            <option value="dots">Dots</option>
                        </select>
                    </label>
                </div>
            </details>
            <!-- Collapsible: Logo/Image Embedding -->
            <details style="margin:10px 0; text-align:left;">
                <summary style="font-weight:600; color:#ff6600; cursor:pointer;">🖼️ Embed Logo/Image</summary>
                <div style="margin:10px 0 0 0;">
                    <input type="file" name="logo" id="logo" accept="image/*">
                    <small style="color:#aaa;">(Optional, PNG/JPG, small square recommended)</small>
                </div>
            </details>
            <!-- Collapsible: Instant Scan Test -->
            <details style="margin:10px 0; text-align:left;">
                <summary style="font-weight:600; color:#ff6600; cursor:pointer;">📷 Instant Scan Test</summary>
                <div style="margin:10px 0 0 0;">
                    <button type="button" id="start-scan" class="scan-btn scan-btn-primary" style="margin-bottom:8px;">Start Camera Scan</button>
                    <div id="scanner" style="display:none; margin-top:10px;"></div>
                    <div id="scan-result" style="margin-top:8px; color:#7cfc00;"></div>
                </div>
            </details>
            <button type="submit" class="main-action-btn">Generate QR Code</button>
        </form>
        <div id="multi-section" style="display:none;">
            <button id="back-btn" type="button" style="margin-bottom: 15px;">&larr; Back</button>
            <div style="margin-bottom: 15px;">
                <label for="qr-count" style="font-weight:600;">How many QR codes?</label>
                <select id="qr-count" name="qr_count" style="padding:8px; border-radius:5px; font-size:15px;">
                    {% for i in range(1, 11) %}
                    <option value="{{ i }}">{{ i }}</option>
                    {% endfor %}
                </select>
            </div>
            <form id="multi-form" method="POST">
                <div id="multi-inputs"></div>
                <button type="submit" style="margin-top:10px;">Generate Multiple QR Codes</button>
                <input type="hidden" name="multi_mode" value="1">
            </form>
        </div>
        {% if multi_qr_results %}
        <div id="multi-results">
            {% for qr in multi_qr_results %}
            <div class="qr-card" style="--qr-color: {{ qr.color }};">
                <div class="qr-label-badge">{{ qr.label }}</div>
                <img class="qr-img-glow" src="data:image/png;base64,{{ qr.qr_img }}" alt="QR Code" style="max-width: 100%; padding: 10px; border-radius: 10px; border: 2px solid {{ qr.color }};" />
                <div class="qr-text">{{ qr.text }}</div>
                <a href="data:image/png;base64,{{ qr.qr_img }}" download="qr_code_{{ qr.label|lower }}.png">
                    <button type="button" class="qr-download-btn">Download</button>
                </a>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% if qr_img_base64 %}
        <div style="margin-top: 25px;">
            <img id="qr-img" class="qr-animated" src="data:image/png;base64,{{ qr_img_base64 }}" alt="QR Code" style="max-width: 100%; background: white; padding: 10px; border-radius: 8px; animation: qrFadeIn 1s cubic-bezier(.4,2,.6,1);" />
            <br>
            <a id="download-btn" href="data:image/png;base64,{{ qr_img_base64 }}" download="qr_code.png">
                <button type="button" style="margin-top: 15px;">Download</button>
            </a>
            <!-- Accessibility: Read QR Content -->
            <div style="margin-top:18px;">
                <button type="button" id="read-qr-text" data-qr-content="{{ text }}">🔊 Read QR Content</button>
                <div id="qr-desc" style="margin-top:8px; color:#ffd700;"></div>
            </div>
            <!-- Share Options -->
            <div style="margin-top:18px;">
                <div style="font-size:1.08rem; color:#ffb300; font-weight:600; margin-bottom:7px;">Share your QR code:</div>
                <button type="button" id="share-email" data-qr-content="{{ text }}">Email</button>
                <button type="button" id="share-whatsapp" data-qr-content="{{ text }}">WhatsApp</button>
                <button type="button" id="share-twitter" data-qr-content="{{ text }}">Twitter</button>
            </div>
        </div>
        {% endif %}
        <div id="verify-section" style="display:none; margin-top:30px;">
            <button id="verify-back-btn" type="button" class="verify-btn-secondary" style="margin-bottom: 15px;">&larr; Back</button>
            <h2 style="color:#00ff88; font-family:'Fira Mono',monospace;">Verify QR Code</h2>
            <div id="verify-camera-controls" style="margin-bottom:18px; display:flex; flex-wrap:wrap; gap:12px; justify-content:center; align-items:center;"></div>
            <div id="verify-scanner" style="display:none; margin-top:10px;"></div>
            <div id="verify-result" style="margin-top:18px; color:#7cfc00; font-size:1.1rem;"></div>
        </div>
    </div>
    <style>
    @keyframes qrFadeIn {
        0% { opacity: 0; transform: scale(0.7) rotate(-10deg); }
        60% { opacity: 1; transform: scale(1.1) rotate(2deg); }
        100% { opacity: 1; transform: scale(1) rotate(0deg); }
    }
    @keyframes scanline {
        0% { top: -100%; }
        100% { top: 100%; }
    }
    </style>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
    <script>
    // Section toggling
    const mainMenu = document.getElementById('main-menu');
    const singleBtn = document.getElementById('single-btn');
    const multiBtn = document.getElementById('multi-btn');
    const singleForm = document.getElementById('single-form');
    const multiSection = document.getElementById('multi-section');
    const backBtn = document.getElementById('back-btn');
    const multiInputs = document.getElementById('multi-inputs');
    const qrCount = document.getElementById('qr-count');
    const natureLabels = {{ nature_labels|tojson }};

    function showSingle() {
        mainMenu.style.display = 'none';
        singleForm.style.display = 'block';
        multiSection.style.display = 'none';
    }
    function showMulti() {
        mainMenu.style.display = 'none';
        singleForm.style.display = 'none';
        multiSection.style.display = 'block';
        renderMultiInputs();
    }
    function showMenu() {
        mainMenu.style.display = 'block';
        singleForm.style.display = 'none';
        multiSection.style.display = 'none';
    }
    singleBtn.onclick = showSingle;
    multiBtn.onclick = showMulti;
    backBtn.onclick = showMenu;
    qrCount.onchange = renderMultiInputs;

    function renderMultiInputs() {
        const count = parseInt(qrCount.value);
        multiInputs.innerHTML = '';
        for (let i = 0; i < count; i++) {
            const [label, color] = natureLabels[i];
            const div = document.createElement('div');
            div.style.marginBottom = '12px';
            div.innerHTML = `<label style="font-weight:600; color:${color};">${label}</label><br>
                <input type="text" name="multi_text" placeholder="Enter ${label} text/link" class="multi-field" style="border:2px solid ${color}; background: #222; color: white; border-radius:5px; padding:10px; width:90%;" ${i===0?'required':''}>`;
            multiInputs.appendChild(div);
        }
    }
    // Show main menu on load
    showMenu();

    // Random scatter effect for QR cards (desktop only)
    function randomizeQrCards() {
        if (window.innerWidth <= 900) return; // skip on mobile/tablet
        const cards = document.querySelectorAll('.qr-card');
        cards.forEach((card, i) => {
            const tx = Math.round((Math.random() - 0.5) * 60); // -30 to +30px
            const ty = Math.round((Math.random() - 0.5) * 40); // -20 to +20px
            const rot = Math.round((Math.random() - 0.5) * 10); // -5 to +5deg
            card.style.transform = `translate(${tx}px, ${ty}px) rotate(${rot}deg)`;
            card.style.zIndex = 10 + Math.abs(rot);
        });
    }
    if (document.getElementById('multi-results')) {
        randomizeQrCards();
        window.addEventListener('resize', randomizeQrCards);
    }

    // Feature: Verify QR Camera and Upload (with camera selection)
    const verifyCameraControls = document.getElementById('verify-camera-controls');
    const verifyScannerDiv = document.getElementById('verify-scanner');
    const verifyResult = document.getElementById('verify-result');
    let verifyQr;
    let selectedDeviceId = null;
    function setupVerifyCameraUI() {
        Html5Qrcode.getCameras().then(devices => {
            verifyCameraControls.innerHTML = '';
            if (!devices || devices.length === 0) {
                verifyCameraControls.innerHTML = '<span style="color:#ff1744;">No camera found. Please connect a camera and reload.</span>';
                return;
            }
            let selectHtml = '';
            if (devices.length > 1) {
                selectHtml = '<select id="verify-camera-select" style="margin-right:10px; padding:4px 8px; border-radius:6px; font-size:0.98rem;">' +
                    devices.map((d, i) => `<option value="${d.id}">${d.label || 'Camera ' + (i+1)}</option>`).join('') + '</select>';
            }
            verifyCameraControls.innerHTML = `
                ${selectHtml}
                <button id="verify-camera-btn" type="button" class="verify-btn-primary">Scan with Camera</button>
                <label for="verify-upload" class="verify-btn-secondary" style="display:inline-block; cursor:pointer; margin:0;">Upload Image
                    <input type="file" id="verify-upload" accept="image/*" style="display:none;">
                </label>
            `;
            const cameraSelect = document.getElementById('verify-camera-select');
            if (cameraSelect) {
                selectedDeviceId = cameraSelect.value;
                cameraSelect.onchange = function() { selectedDeviceId = this.value; };
            } else {
                selectedDeviceId = devices[0].id;
            }
            document.getElementById('verify-camera-btn').onclick = function() {
                verifyScannerDiv.style.display = 'block';
                verifyResult.textContent = '';
                if (!verifyQr) verifyQr = new Html5Qrcode("verify-scanner");
                verifyQr.start(
                    { deviceId: { exact: selectedDeviceId } },
                    { fps: 10, qrbox: 250 },
                    qrCodeMessage => {
                        verifyResult.textContent = 'Scanned: ' + qrCodeMessage;
                        verifyQr.stop();
                    },
                    errorMessage => {}
                ).catch(err => {
                    verifyResult.innerHTML = 'Camera error: ' + err + '<br><span style="color:#ffd600;">Please allow camera access and ensure no other app is using it.</span>';
                });
            };
            document.getElementById('verify-upload').onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                verifyResult.textContent = 'Processing...';
                const reader = new FileReader();
                reader.onload = function(ev) {
                    Html5Qrcode.getCameras().then(() => {
                        Html5QrcodeScanner.scanFile(ev.target.result, true)
                            .then(decodedText => {
                                verifyResult.textContent = 'Decoded: ' + decodedText;
                            })
                            .catch(err => {
                                verifyResult.textContent = 'Could not decode QR: ' + err;
                            });
                    });
                };
                reader.readAsDataURL(file);
            };
        });
    }
    // Call on load and when showing verify section
    function showVerify() {
        mainMenu.style.display = 'none';
        singleForm.style.display = 'none';
        multiSection.style.display = 'none';
        verifySection.style.display = 'block';
        setupVerifyCameraUI();
    }
    verifyBtn.onclick = showVerify;
    verifyBackBtn.onclick = showMenu;

    // Feature 6: Instant Scan Test
    const startScanBtn = document.getElementById('start-scan');
    const scannerDiv = document.getElementById('scanner');
    const scanResult = document.getElementById('scan-result');
    let html5Qr;
    if (startScanBtn) {
        startScanBtn.onclick = function() {
            scannerDiv.style.display = 'block';
            scanResult.textContent = '';
            Html5Qrcode.getCameras().then(devices => {
                if (!devices || devices.length === 0) {
                    scanResult.innerHTML = 'No camera found.';
                    return;
                }
                if (!html5Qr) html5Qr = new Html5Qrcode("scanner");
                html5Qr.start(
                    { deviceId: { exact: devices[0].id } },
                    { fps: 10, qrbox: 200 },
                    qrCodeMessage => {
                        scanResult.textContent = 'Scanned: ' + qrCodeMessage;
                        html5Qr.stop();
                    },
                    errorMessage => {}
                ).catch(err => {
                    scanResult.innerHTML = 'Camera error: ' + err + '<br><span style="color:#ffd600;">Please allow camera access and ensure no other app is using it.</span>';
                });
            });
        };
    }

    // Verify QR Section
    const verifyBtn = document.getElementById('verify-btn');
    const verifySection = document.getElementById('verify-section');
    const verifyBackBtn = document.getElementById('verify-back-btn');
    function showVerify() {
        mainMenu.style.display = 'none';
        singleForm.style.display = 'none';
        multiSection.style.display = 'none';
        verifySection.style.display = 'block';
    }
    verifyBtn.onclick = showVerify;
    verifyBackBtn.onclick = showMenu;

    // Upload QR image for Verify QR
    if (verifyUploadBtn && verifyUploadInput) {
        verifyUploadBtn.onclick = function() {
            verifyUploadInput.click();
        };
        verifyUploadInput.onchange = function(e) {
            const file = e.target.files[0];
            if (!file) return;
            verifyResult.textContent = 'Processing...';
            const reader = new FileReader();
            reader.onload = function(ev) {
                Html5Qrcode.getCameras().then(() => {
                    Html5QrcodeScanner.scanFile(ev.target.result, true)
                        .then(decodedText => {
                            verifyResult.textContent = 'Decoded: ' + decodedText;
                            // Optionally: send to backend for trust validation
                        })
                        .catch(err => {
                            verifyResult.textContent = 'Could not decode QR: ' + err;
                        });
                });
            };
            reader.readAsDataURL(file);
        };
    }
    // Feature 7: Share Options (moved to after QR generation)
    function getQRContentFromButton(btnId) {
        const btn = document.getElementById(btnId);
        return btn ? btn.getAttribute('data-qr-content') : '';
    }
    const shareEmailBtn = document.getElementById('share-email');
    if (shareEmailBtn) {
        shareEmailBtn.onclick = function() {
            const subject = encodeURIComponent('Check out this QR code!');
            const body = encodeURIComponent('Here is a QR code for you: ' + getQRContentFromButton('share-email'));
            window.location.href = 'mailto:?subject=' + subject + '&body=' + body;
        };
    }
    const shareWhatsAppBtn = document.getElementById('share-whatsapp');
    if (shareWhatsAppBtn) {
        shareWhatsAppBtn.onclick = function() {
            const text = encodeURIComponent('Check out this QR code! ' + getQRContentFromButton('share-whatsapp'));
            window.open('https://wa.me/?text=' + text, '_blank');
        };
    }
    const shareTwitterBtn = document.getElementById('share-twitter');
    if (shareTwitterBtn) {
        shareTwitterBtn.onclick = function() {
            const text = encodeURIComponent('Check out this QR code! ' + getQRContentFromButton('share-twitter'));
            window.open('https://twitter.com/intent/tweet?text=' + text, '_blank');
        };
    }
    // Feature 9: Accessibility (Read QR Content, moved to after QR generation)
    const readBtn = document.getElementById('read-qr-text');
    const qrDesc = document.getElementById('qr-desc');
    if (readBtn) {
        readBtn.onclick = function() {
            const text = readBtn.getAttribute('data-qr-content') || '';
            qrDesc.textContent = 'QR Content: ' + text;
            if ('speechSynthesis' in window) {
                const utter = new SpeechSynthesisUtterance(text);
                window.speechSynthesis.speak(utter);
            }
        };
    }
    </script>
    {% if trust_result %}
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            var trustStatus = document.getElementById('trust-status');
            trustStatus.style.display = 'inline-block';
            trustStatus.innerHTML = `<span title="{{ trust_result.reason }}" style="font-size:1.3em; color:{{ 'lime' if trust_result.score=='safe' else ('#ffd600' if trust_result.score=='suspicious' else '#ff1744') }}; filter: drop-shadow(0 0 6px {{ 'lime' if trust_result.score=='safe' else ('#ffd600' if trust_result.score=='suspicious' else '#ff1744') }}); cursor: pointer; vertical-align:middle;">{{ trust_result.icon }}</span>`;
        });
        </script>
        {% endif %}
        {% if show_trust_modal %}
        <div id="trust-modal" style="position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.88); z-index:9999; display:flex; align-items:center; justify-content:center;">
            <div style="background:rgba(10,30,10,0.98); border:3px solid #00ff88; border-radius:18px; box-shadow:0 0 32px #00ff88cc; padding:38px 28px; max-width:90vw; text-align:center; color:#eafbe6; font-family:'Fira Mono',monospace;">
                <div style="font-size:2.2em; margin-bottom:18px; color:#ffd600; text-shadow:0 0 12px #ffd600;">{{ trust_result.icon }} QR Trust Score: <b style='color:#ffd600;'>{{ trust_result.score|capitalize }}</b></div>
                <div style="margin-bottom:18px; font-size:1.1em; color:#fff;">Reason: <span style="color:#00ff88;">{{ trust_result.reason }}</span></div>
                <div style="margin-bottom:24px; color:#ff1744; font-size:1.1em;">This link may be unsafe. Do you still want to generate the QR code?</div>
                <form method="POST" enctype="multipart/form-data" style="display:inline;">
                    <input type="hidden" name="text" value="{{ text }}">
                    <input type="hidden" name="qr_color" value="{{ qr_color }}">
                    <input type="hidden" name="bg_color" value="{{ bg_color }}">
                    <input type="hidden" name="trust_override" value="1">
                    <button type="submit" style="background:#00ff88; color:#000; font-weight:700; border-radius:8px; padding:12px 32px; margin-right:18px; box-shadow:0 0 16px #00ff88cc;">Continue</button>
                    <button type="button" onclick="document.getElementById('trust-modal').style.display='none';" style="background:#222; color:#fff; border:2px solid #00ff88; border-radius:8px; padding:12px 32px;">Cancel</button>
                </form>
            </div>
        </div>
        <script>
        document.body.style.overflow = 'hidden';
        </script>
        {% endif %}
</body>
</html>
